<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta charset="utf-8"/>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

		<script type="text/javascript" src="vector.js"></script>

		<script type="text/javascript" src="engine/particle.js"></script>
		<script type="text/javascript" src="engine/physics.js"></script>

		<script type="text/javascript" src="behaviour/behaviour.js"></script>
		<script type="text/javascript" src="behaviour/constant_force.js"></script>
		<script type="text/javascript" src="behaviour/attraction.js"> </script>
		<script type="text/javascript" src="behaviour/collision.js"> </script>



		<script type="text/javascript" src="renderer/webglrend.js"></script>
	</head>
	
	<body onload="main()">
		<script id="2d-vertex-shader" type="nonjs">
			precision mediump float;

			attribute vec2 a_position;

			attribute float a_radius;

			uniform vec2 u_resolution;

			varying vec4 v_color;

			void main() {
				vec2 zeroToOne = a_position / u_resolution;

				vec2 zeroToTwo = zeroToOne * 2.0;
				
				vec2 clipSpace = zeroToTwo - 1.0;

				gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);	

				gl_PointSize = a_radius*2.0;

				v_color = gl_Position * 0.9 + 0.5;	
			}
		</script>

		<script id="2d-fragment-shader" type="nonjs">
			precision mediump float;

			uniform vec4 u_color;

			varying vec4 v_color;

			void main() {
				gl_FragColor = v_color;
			}
		</script>

		<script type="text/javascript">

			//https://webglfundamentals.org/webgl/lessons/webgl-fundamentals.html
			/*function createShader(gl, type, source) {
				var shader = gl.createShader(type);
				gl.shaderSource(shader, source);
				gl.compileShader(shader);
				var success = gl.getShaderParameter(shader, gl.COMPILE_STATUS);
				if (success) {
					return shader;
				}

				console.log(gl.getShaderInfoLog(shader));
				gl.deleteShader(shader);
			}

			function createProgram(gl, vertexShader, fragmentShader) {
				var program = gl.createProgram();
				gl.attachShader(program, vertexShader);
				gl.attachShader(program, fragmentShader);
				gl.linkProgram(program);
				var success = gl.getProgramParameter(program, gl.LINK_STATUS);

				if (success) {
					return program;
				}

				console.log(gl.getProgramInfoLog(program));
				gl.deleteProgram(program);
			} */

			function main() {
				const canvas = document.querySelector("#cont");

				var ohno = new webglrend(canvas);
				ohno.init();

				phys = new physics();
				c = new constant_force(new vector(20, 20));
				c1 = new constant_force(new vector(0, -10));
				a1 = new attraction(100, 1000, new vector(320,240));
				col = new collision();

				var a = new vector(2, 2)
				var b = new vector(1, 1)

				//a.multiplyScalar(10)

				//console.log(vector.multiplyScalar(a, 10))

				poss = [new vector(0, 0), new vector(500, 480)]

				fv = [new vector(5000, 5000), new vector(-5000, -5000)]

				for (var i = 0; i < 5; i++) {
					temprand = Math.random();
					temp = new particle(temprand, temprand*10);
					//console.log(temp);
					randomPosition = new vector(Math.floor(Math.random()*500), Math.floor(Math.random()*450));

					//console.log(randomPosition.y)

					color = [Math.random(), Math.random(), Math.random(), 1].toString();

					//console.log(randomPosition.y)

					temp.setColor(color);

					temp.setPos(randomPosition) //new vector(100, 100));

					col.pool.push(temp)

					temp.behaviours.push(a1, col)

					//temp.forceVec = fv[i]

					phys.particles.push(temp)
				}

				

				function draw() { 
					
					//console.log(particles)
					phys.step()
					ohno.render(phys.particles)
					window.requestAnimationFrame(draw) 					
				}

				draw()
			}

		</script>

		<div>
			<canvas id="cont" width="640" height="480" > </canvas>
		</div>
	</body>
</html>